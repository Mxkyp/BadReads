#!/usr/bin/env bash
#ENV
backend_dir=./backend/
frontend_dir=./frontend/
database_dir=./database/

set -e # fail on error

build_image() {
  if [[ $1 =~ ^backend(|:[A-Za-z0-9_.-]*)$ || $1 =~ ^frontend(|:[A-Za-z0-9_.-]*)$ || $1 =~ ^database(|:[A-Za-z0-9_.-]*)$ ]]; then
    dir_var="${1%%:*}_dir" # omit the tag if present
    docker build --tag $1 "${!dir_var}"
  else
    echo "invalid service name $1 use -h or --help for example usage"
    exit 1
  fi
}

printHelpAndExit() {
  echo "-----------------------------------------"
  echo "build docker images of specified services"
  echo "allows specifing tags"
  echo "services: backend, frontend, database"
  echo "example usage:"
  echo "1) ./build_images backend:2.1 frontend:2.3"
  echo "2) ./build_images database"
  echo "-----------------------------------------"
}

if [[ -n $1 && $# -le 3 ]]; then
  if [[ $1 == "-h" || $1 == "--help" ]]; then
    help_function
  else
    for var in "$@"; do
      build_image $var
    done
  fi
fi
